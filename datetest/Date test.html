<!DOCTYPE html>
<html lang="en">
    <style>
        .chartstyle{
            padding: 20px;
            width: 700px;
        }
        #inputbox{
            border: solid 1#333;
            padding: 5px 10px;
            margin: 5px;
        }



    </style>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>財金網頁測試版</title>
    </head>
    <body>
        <h1>Date test</h1>
        <div class="chartstyle">
            <canvas id="myChart" width="50%" height="50%"></canvas>
        </div>

        <div class="inputstyle">
            <input type="date" id="date" class="inputbox">
            <input type="time" id="time" class="inputbox">
            <p>c:<input type="text" id="c" class="inputbox"></p>
            <button id="showpmf" onclick="showdate()">確定</button>
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>

            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'pmf',
                        lineTension: 0,
                        data: [],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });            

            function showdate(){
                var date = document.getElementById('date');
                var time = document.getElementById('time');
                var c = document.getElementById('c');
                //console.log(date.value);
                //console.log(time.value);//確認有抓到輸入的日期時間的地方
                var weekArray = new Array('Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri','Sat');
                date = date.value;
                date = date.replace(/-/g,'/');
                var day = new Date(date).getDay();//將日期轉換成csv要用的形式
                //console.log(day);
                //console.log(weekArray[day]);
                time = time.value;
                time = time.replace(/:/g,'');
                time = time+'00';//將時間轉換成csv要用的形式
                var select = weekArray[day]+'_'+time;//之後用來尋找csv列的名字的變數
                console.log(time);
                console.log(select);
                
                var url = "https://github.com/MDFK8787/111project/tree/gh-pages/datetest/json";
                var request = new XMLHttpRequest();
                request.open("get", url);
                request.send(null);
                request.onload = function () {
                    if (request.status == 200) {
                        var json = JSON.parse(request.responseText);
                        console.log(json);

                        var x = [];
                        var y = [];

                        var len_json = Object.keys(json).length; //宣告json長度
                        for (i=0;i<len_json;i++){
                            console.log(json[i]);

                            var strike = json[i];//將每一個index的陣列分別抓出來讓select可以選日期時間的columns
                            var strike2 = strike[select];//用日期時間的select選擇陣列
                            
                            //console.log(strike2);
                            x.push(strike2);
                            
                            var prob = json[i].field1;//抓出index
                            //console.log(prob);
                            prob1 = (++prob)*c.value;//轉換成歷史指數,之後變數c要連歷史資料##
                            //console.log(prob);
                            y.push(prob1);

                        };
                        console.log(x);
                        console.log(y);
                        myChart.data.label = y;
                        myChart.data.datasets[0].data = x;

                        myChart.update()
                    };
                };

            }
            
            




        </script>

    </body>